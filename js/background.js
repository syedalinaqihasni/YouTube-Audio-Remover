(()=>{"use strict";new class{tabIds=new Map;constructor(){this.tabIds=new Map,chrome.storage.local.get("audio_only_youtube_disabled",(e=>{let s=e.audio_only_youtube_disabled;void 0===s&&(s=!1,this.saveSettings(s)),s?this.disableExtension():this.enableExtension()})),chrome.action.onClicked.addListener((()=>{chrome.storage.local.get("audio_only_youtube_disabled",(e=>{let s=e.audio_only_youtube_disabled;s?this.enableExtension():this.disableExtension(),s=!s,this.saveSettings(s)})),chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.youtube.com/*"},(e=>{e.length>0&&chrome.tabs.update(e[0].id,{url:e[0].url})}))}))}removeURLParameters=(e,s)=>{const t=e.split("?");if(t.length<2)return;let i=t[1].split(/[&;]/g);const o=s.map((e=>`${encodeURIComponent(e)}=`)),n=i.filter((e=>!o.some((s=>e.startsWith(s)))));return`${t[0]}?${n.join("&")}`};processRequest=e=>{const{url:s,tabId:t}=e;if(!s.includes("mime=audio"))return;if(s.includes("live=1"))return this.tabIds.set(t,""),void this.sendMessage(t);const i=this.removeURLParameters(s,["range","rn","rbuf","ump"]);i&&this.tabIds.get(t)!==i&&(this.tabIds.set(t,i),this.sendMessage(t))};sendMessage=e=>{this.tabIds.has(e)&&chrome.tabs.sendMessage(e,{url:this.tabIds.get(e)})};enableExtension=()=>{chrome.action.setIcon({path:{19:"../img/icon19.png",38:"../img/icon38.png"}}),chrome.tabs.onUpdated.addListener(this.sendMessage),chrome.webRequest.onBeforeRequest.addListener(this.processRequest,{urls:["<all_urls>"]})};disableExtension=()=>{chrome.action.setIcon({path:{19:"../img/disabled_icon19.png",38:"../img/disabled_icon38.png"}}),chrome.tabs.onUpdated.removeListener(this.sendMessage),chrome.webRequest.onBeforeRequest.removeListener(this.processRequest),this.tabIds.clear()};saveSettings=e=>{chrome.storage.local.set({audio_only_youtube_disabled:e})}}})();